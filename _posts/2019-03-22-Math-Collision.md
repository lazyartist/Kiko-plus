---
layout: post
title: "Math - Collision"
description: ""
date: 2019-03-22 19:00:00+09:00
tags: [game, math, math]
comments: true
share: true
---

## 충돌 판정에 사용하는 형태

|        형태         | 특징                                                         | 구조체                                                       |
| :-----------------: | ------------------------------------------------------------ | ------------------------------------------------------------ |
|        선분         | - 좌표 2개를 이은 선<br />- 굵기가 없는 선 형태              | 시작점, 벡터                                                 |
|         구          | - 중심에서 같은 거리에 있는 면으로 만든 형태<br />- 중심과 반지름으로 표현 | 중심좌표, 반지름                                             |
| 평면<br /> (삼각형) | - 3차원 공간에 무한히 퍼져 있는 평평한 면<br />- 평면 방정식으로 표현<br />- 삼각형일 때는 평면을 범위로 제한 | - 평면의 성분<br />- 꼭짓점 3개, 삼각형을 포함하는 평면(계산 편의) |



## 선분과 선분 충돌

#### 직선의 방정식


$$
P:시작점, V:벡터 \\
y = \frac{V_y}{V_x}(x-p_x)+p_y
$$

#### 직선의 충돌(교점)

직선이 충돌한다는 것은 교점이 있다는 것

두 직선의 방정식을 연립하여 해를 구하면 된다.

​	해가 없다. -> 교점이 없다. 충돌(교차)하지 않는다.

​	해가 무수히 많다. -> 두 직선이 겹친다. 기울기와 y절편이 같다. 충돌(교차)하지 않는다.

​	해가 하나이다. -> 교점이 있다. 충돌(교차)한다.

$$
P:시작점, a:기울기 \\
y = a_1(x-p_{1x})+p_{1y} \\
y = a_2(x-p_{2x})+p_{2y} \\
$$


$$
\text{y에 대입}\\\\
a_1(x-p_{1x})+p_{1y} = a_2(x-p_{2x})+p_{2y} \\
a_1x-a_1p_{1x}+p_{1y} = a_2x-a_2p_{2x}+p_{2y} \\
a_1x-a_2x = -a_2p_{2x}+p_{2y}+a_1p_{1x}-p_{1y} \\
\therefore x = \frac{-a_2p_{2x}+p_{2y}+a_1p_{1x}-p_{1y}}{a_1-a_2} \\
$$


$$
\require{cancel}
\text{x에 대입}\\\\
y = a_1x-a_1p_{1x}+p_{1y}\\
y = a_1(\frac{-a_2p_{2x}+p_{2y}+a_1p_{1x}-p_{1y}}{a_1-a_2})-a_1p_{1x}+p_{1y} \\
y = \frac{-a_1a_2p_{2x}+a_1p_{2y}+a_1^2p_{1x}-a_1p_{1y}}{a_1-a_2}-a_1p_{1x}+p_{1y} \\
y = \frac{-a_1a_2p_{2x}+a_1p_{2y}+a_1^2p_{1x}-a_1p_{1y}}{a_1-a_2} - 
\frac{a_1^2p_{1x}-a_1a_2p_{1x}}{a_1-a_2} +
\frac{a_1p_{1y}-a_2p_{1y}}{a_1-a_2} \\
y = \frac{-a_1a_2p_{2x}+a_1p_{2y}+\cancel{a_1^2p_{1x}}-\cancel{a_1p_{1y}} - \cancel{a_1^2p_{1x}} + a_1a_2p_{1x} + \cancel{a_1p_{1y}}-a_2p_{1y}}{a_1-a_2} \\
\therefore y = \frac{-a_1a_2p_{2x}+a_1p_{2y} + a_1a_2p_{1x} - a_2p_{1y}}{a_1-a_2}
$$



#### 선분의 충돌(교점)

직선의 교점이 두 선분의 영역안에 있는지 확인한다.

x축 방향 벡터가 0이면 기울기 계산 시 0으로 나누게 되므로 다른 처리가 필요하다.

- 기울기가 같다 : 평행
- 기울기가 같고 y절편이 다르다 : 평행
- 기울기가 같고 y절편이 같다 : 겹침



## 선분과 구의 충돌

#### t를 사용하여 선분 위의 점 표현하기

> t는 0.0 ~ 1.0 사이의 값
>
> 시작점 P
>
> 시작점에서의 벡터 V
>
> 선분위의 점 (x, y, z)

$$
x = P_x + V_xt \\
y = P_y + V_yt \\
z = P_z + V_zt \\
$$



#### 구의 방정식

> 중심 : (a, b, c)
> 반지름 : r
> 구면 위의 점 : (x, y, z)

$$
\text{구의 방정식 표준형} \\
(a-x)^2+(b-y)^2+(c-z)^2=r^2
$$



$$
\text{구의 방정식 일반형(표준형의 전개)} \\
x^2 + y^2 + z^2 - 2ax - 2by - 2cz + a^2 + b^2 + c^2 - r^2 = 0 \\
x^2 + y^2 + z^2 + Ax + By + Cz + D = 0 
$$



#### 이차 방정식의 근의 공식

$$
ax^2 + bx + c = 0 \\
x = \frac{-b \pm \sqrt{b^2-4ac} }{2a}
$$



###### 일차항에 상수 2가 곱해진 경우의 근의 공식

$$
ax^2 + 2bx + c = 0 \\
x = \frac{-b \pm \sqrt{b^2-ac} }{a}
$$

###### 근의 공식의 판별식(Discriminant)

$$
D = b^2 - 4ac
$$

| D     | 의미                         |
| ----- | ---------------------------- |
| D > 0 | 서로 다른 두 근              |
| D = 0 | 중근(완전 제곱식, 근이 하나) |
| D < 0 | 근이 없다                    |



#### 선분과 구의 충돌 검출

> (a, b, c) : 구의 중심
>
> r : 구의 반지름

$$
(a - x)^2 + (b - y)^2 + (c - z)^2 = r^2 \\
\text{구의 방정식에 직선의 (x, y, z)를 대입} \\
(a - P_x + V_xt)^2 + (b - P_y + V_yt)^2 + (c - P_z + V_zt)^2 = r^2 \\
\text{다음과 같이 치환} \\
k_x = a - P_x \\
k_y = b - P_y \\
k_z = c - P_z \\
(k_x + V_xt)^2 + (k_y + V_yt)^2 + (k_z + V_zt)^2 = r^2 \\
\text{전개} \\
k_x^2 + 2k_xV_xt + V_x^2t^2 + k_y^2 + 2k_yV_yt + V_y^2t^2 + k_z^2 + 2k_zV_zt + V_z^2t^2 = r^2 \\
(V_x^2 + V_y^2 + V_z^2)t^2 + 2(k_xV_x + k_yV_y + k_zV_z)t + k_x^2 + k_y^2 + k_z^2 - r^2 \\
\text{다음과 같이 나타낼 수 있다} \\
at^2 + bt + c = 0 \\
\text{ 꼴이기 때문에 근의 공식으로 t값을 구할 수 있다.} \\
t = \frac{-b \pm \sqrt{b^2-4ac} }{2a} \\
\therefore \text{t값을 구한 뒤 선분위의 점 방정식에 대입하여 x, y, z 값을 구하면 된다.}
$$



###### t값의 의의

| t값의 개수 | t값의 범위          | 의미                                                         |
| ---------- | ------------------- | ------------------------------------------------------------ |
| 0          | -                   | 충돌 X                                                       |
| 1          | 0~1 사이            | 한 점에서 선분 충돌 O                                        |
| 1          | 0~1 벗어남          | 선분 충돌 X, 직선 충돌 O                                     |
| 2          | t값 하나만 0~1 사이 | 한 점에서 선분 충돌 O, 원에 걸침                             |
| 2          | t값 둘 다 0~1 사이  | 두 점에서 선분 충돌 O, 원을 관통<br />t값이 작은 쪽이 시작점에 가깝다. |

실제 프로그램에서는 판별식으로 직선이 충돌했는지를 먼저 계산하면 불필요한 계산을 줄일 수 있다.



